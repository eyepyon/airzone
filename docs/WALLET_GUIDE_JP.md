# ウォレット管理ガイド

## 概要

Airzoneでは、ユーザーが2種類のウォレットを使用できます：

1. **自動生成ウォレット**: システムが自動的に作成・管理
2. **Xaman Wallet**: ユーザーが自分のウォレットを接続

## ウォレットタイプの比較

| 項目 | 自動生成ウォレット | Xaman Wallet |
|------|------------------|--------------|
| **生成方法** | ユーザー登録時に自動 | ユーザーが手動で接続 |
| **秘密鍵管理** | バックエンドで暗号化保存 | ユーザーのデバイス |
| **セキュリティ** | 標準（暗号化済み） | 高（ユーザー管理） |
| **使いやすさ** | ★★★★★ 簡単 | ★★★☆☆ アプリ必要 |
| **初期設定** | 不要 | Xamanアプリのインストール |
| **推奨用途** | 初心者・簡単に始めたい | セキュリティ重視・既存ウォレット保有者 |

## 自動生成ウォレット

### 特徴

- **自動作成**: ユーザー登録時に自動的に生成
- **透過的**: ユーザーは意識する必要なし
- **即座に利用可能**: 登録後すぐにNFTを受け取れる
- **バックアップ不要**: システムが管理

### セキュリティ

1. **暗号化**: 秘密鍵はFernet対称暗号化で保護
2. **環境変数**: 暗号化キーは環境変数で管理
3. **アクセス制御**: 認証されたユーザーのみアクセス可能

### 使い方

ユーザーは何もする必要がありません。登録すると自動的にウォレットが作成されます。

```
ユーザー登録
    ↓
自動的にXRPLウォレット生成
    ↓
NFT受け取り準備完了
```

## Xaman Wallet

### 特徴

- **ユーザー管理**: 秘密鍵はユーザーのデバイスに保存
- **高セキュリティ**: 秘密鍵がサーバーに保存されない
- **マルチデバイス**: スマホ・PC・タブレットで利用可能
- **既存ウォレット**: 既に持っているウォレットを使用可能

### 必要なもの

1. **Xamanアプリ**: 
   - iOS: [App Store](https://apps.apple.com/app/xumm/id1492302343)
   - Android: [Google Play](https://play.google.com/store/apps/details?id=com.xrpllabs.xumm)

2. **XRPLアカウント**: Xamanアプリで作成可能

### 接続方法

#### ステップ1: Xamanアプリのインストール

1. スマートフォンにXamanアプリをインストール
2. アプリを開いてアカウントを作成
3. バックアップフレーズを安全に保管

#### ステップ2: Airzoneで接続

1. Airzoneにログイン
2. ダッシュボードで「Xaman Walletを接続」ボタンをクリック
3. QRコードが表示される
4. Xamanアプリでスキャン
5. アプリで「承認」をタップ
6. 接続完了！

```
Airzoneで「接続」
    ↓
QRコード表示
    ↓
Xamanアプリでスキャン
    ↓
承認
    ↓
接続完了
```

### 切断方法

1. ダッシュボードで「切断」ボタンをクリック
2. 自動的に新しい自動生成ウォレットが作成される
3. 以降のNFTは新しいウォレットに送信される

## ウォレットの切り替え

### 自動生成 → Xaman Wallet

```
1. Xaman Walletを接続
   ↓
2. ウォレットアドレスが更新される
   ↓
3. 以降のNFTはXaman Walletに送信
   ↓
4. 既存のNFTは元のウォレットに残る
```

### Xaman Wallet → 自動生成

```
1. 「切断」ボタンをクリック
   ↓
2. 新しい自動生成ウォレットが作成される
   ↓
3. 以降のNFTは新しいウォレットに送信
   ↓
4. Xaman WalletのNFTはそのまま保持
```

## NFTの確認

### 自動生成ウォレット

Airzoneのダッシュボードで確認：
- マイNFT一覧
- NFT詳細情報
- トランザクション履歴

### Xaman Wallet

2つの方法で確認可能：

1. **Xamanアプリ**:
   - アプリを開く
   - 「NFTs」タブを選択
   - 保有NFT一覧を表示

2. **XRPLエクスプローラー**:
   - https://testnet.xrpl.org/ にアクセス
   - ウォレットアドレスを検索
   - NFTタブを確認

## セキュリティのベストプラクティス

### 自動生成ウォレット

1. **強力なパスワード**: Airzoneアカウントに強力なパスワードを設定
2. **2要素認証**: Google認証を有効化
3. **定期的なログアウト**: 共有デバイスでは必ずログアウト

### Xaman Wallet

1. **バックアップフレーズの保管**: 紙に書いて安全な場所に保管
2. **PINコードの設定**: Xamanアプリに強力なPINを設定
3. **生体認証**: 指紋認証・顔認証を有効化
4. **フィッシング対策**: 公式アプリのみ使用

## トラブルシューティング

### 自動生成ウォレット

#### Q: ウォレットが表示されない
A: ログアウトして再度ログインしてください。

#### Q: NFTが届かない
A: 
1. トランザクション履歴を確認
2. ネットワーク状態を確認
3. サポートに問い合わせ

### Xaman Wallet

#### Q: 接続できない
A:
1. Xamanアプリが最新版か確認
2. インターネット接続を確認
3. QRコードを再生成

#### Q: NFTがXamanアプリに表示されない
A:
1. アプリを再起動
2. ネットワークを「Testnet」に設定（開発環境の場合）
3. 数分待ってから再確認

#### Q: ウォレットを切断したらNFTが消えた
A:
NFTは消えていません。元のXaman Walletに残っています。
Xamanアプリで確認してください。

## よくある質問

### Q: どちらのウォレットを使うべき？

**初心者・簡単に始めたい**: 自動生成ウォレット（デフォルト）
**セキュリティ重視・既存ウォレット保有**: Xaman Wallet

### Q: 後から切り替えられる？

はい、いつでも切り替え可能です。

### Q: 両方のウォレットを同時に使える？

いいえ、一度に1つのウォレットのみ使用できます。
切り替えると、以降のNFTは新しいウォレットに送信されます。

### Q: 既存のNFTはどうなる？

元のウォレットに残ります。
- 自動生成ウォレット: Airzoneで確認可能
- Xaman Wallet: Xamanアプリで確認可能

### Q: ウォレットを削除できる？

自動生成ウォレットは削除できません（バックアップとして保持）。
Xaman Walletは切断可能です。

## 管理者向け情報

### データベーススキーマ

```sql
CREATE TABLE wallets (
    id CHAR(36) PRIMARY KEY,
    user_id CHAR(36) NOT NULL,
    address VARCHAR(255) NOT NULL,
    private_key_encrypted TEXT,  -- 自動生成のみ
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### API エンドポイント

- `POST /api/v1/wallet/connect` - Xaman Wallet接続
- `POST /api/v1/wallet/disconnect` - ウォレット切断
- `GET /api/v1/wallet/balance` - 残高確認

詳細は [Xaman Wallet統合ガイド](xaman-wallet-integration.md) を参照。

## 関連ドキュメント

- [Xaman Wallet統合ガイド](xaman-wallet-integration.md) - 開発者向け詳細
- [XRPL統合ガイド](xrpl-integration.md) - ブロックチェーン基礎
- [セットアップガイド](SETUP_GUIDE_JP.md) - 初期設定
- [管理パネルガイド](../admin/README.md) - 管理者向け

## 参考リンク

- [Xaman公式サイト](https://xaman.app/)
- [XRPL公式ドキュメント](https://xrpl.org/)
- [XRPLエクスプローラー（Testnet）](https://testnet.xrpl.org/)
